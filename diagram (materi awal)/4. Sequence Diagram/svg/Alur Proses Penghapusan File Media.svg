<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="806px" preserveAspectRatio="none" style="width:1476px;height:806px;background:#FFFFFF;" version="1.1" viewBox="0 0 1476 806" width="1476px" zoomAndPan="magnify"><title>Alur Proses Penghapusan File Media</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="288.1895" x="594.9102" y="27.9951">Alur Proses Penghapusan File Media</text><g><title>main-app .PHP.</title><rect fill="#FFFFFF" height="565.5938" style="stroke:#181818;stroke-width:1;" width="10" x="759.7456" y="149.7266"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1254.2827" y="281.5234"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="308.4609" style="stroke:#181818;stroke-width:1;" width="10" x="1254.2827" y="407.8594"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1259.2827" y="452.125"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1259.2827" y="583.7891"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1259.2827" y="642.0547"/></g><g><title>File Storage .Host.</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1381.5488" y="510.3906"/></g><rect fill="none" height="382.6641" style="stroke:#000000;stroke-width:1.5;" width="1459.0098" x="10" y="325.6563"/><g><title>User .Pemilik.Pegawai.</title><rect fill="#000000" fill-opacity="0.00000" height="606.7266" width="8" x="99.4556" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="103" x2="103" y1="118.5938" y2="725.3203"/></g><g><title>main-app .PHP.</title><rect fill="#000000" fill-opacity="0.00000" height="606.7266" width="8" x="760.7456" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="764.1606" x2="764.1606" y1="118.5938" y2="725.3203"/></g><g><title>postgres-db</title><rect fill="#000000" fill-opacity="0.00000" height="606.7266" width="8" x="1255.2827" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1258.4775" x2="1258.4775" y1="118.5938" y2="725.3203"/></g><g><title>File Storage .Host.</title><rect fill="#000000" fill-opacity="0.00000" height="606.7266" width="8" x="1382.5488" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1386.0879" x2="1386.0879" y1="118.5938" y2="725.3203"/></g><g class="participant participant-head" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.9111" x="20" y="115.292">User (Pemilik/Pegawai)</text><ellipse cx="103.4556" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M103.4556,58.7969 L103.4556,85.7969 M90.4556,66.7969 L116.4556,66.7969 M103.4556,85.7969 L90.4556,100.7969 M103.4556,85.7969 L116.4556,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.9111" x="20" y="737.3154">User (Pemilik/Pegawai)</text><ellipse cx="103.4556" cy="749.1172" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M103.4556,757.1172 L103.4556,784.1172 M90.4556,765.1172 L116.4556,765.1172 M103.4556,784.1172 L90.4556,799.1172 M103.4556,784.1172 L116.4556,799.1172" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.1699" x="703.1606" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.1699" x="710.1606" y="107.292">main-app (PHP)</text></g><g class="participant participant-tail" data-participant="App"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.1699" x="703.1606" y="724.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.1699" x="710.1606" y="744.3154">main-app (PHP)</text></g><g class="participant participant-head" data-participant="DB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.6104" x="1214.4775" y="115.292">postgres-db</text><path d="M1241.2827,66.2969 C1241.2827,56.2969 1259.2827,56.2969 1259.2827,56.2969 C1259.2827,56.2969 1277.2827,56.2969 1277.2827,66.2969 L1277.2827,92.2969 C1277.2827,102.2969 1259.2827,102.2969 1259.2827,102.2969 C1259.2827,102.2969 1241.2827,102.2969 1241.2827,92.2969 L1241.2827,66.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1241.2827,66.2969 C1241.2827,76.2969 1259.2827,76.2969 1259.2827,76.2969 C1259.2827,76.2969 1277.2827,76.2969 1277.2827,66.2969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="DB"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.6104" x="1214.4775" y="737.3154">postgres-db</text><path d="M1241.2827,750.6172 C1241.2827,740.6172 1259.2827,740.6172 1259.2827,740.6172 C1259.2827,740.6172 1277.2827,740.6172 1277.2827,750.6172 L1277.2827,776.6172 C1277.2827,786.6172 1259.2827,786.6172 1259.2827,786.6172 C1259.2827,786.6172 1241.2827,786.6172 1241.2827,776.6172 L1241.2827,750.6172" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1241.2827,750.6172 C1241.2827,760.6172 1259.2827,760.6172 1259.2827,760.6172 C1259.2827,760.6172 1277.2827,760.6172 1277.2827,750.6172" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Storage"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144.9219" x="1314.0879" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130.9219" x="1321.0879" y="107.292">File Storage (Host)</text></g><g class="participant participant-tail" data-participant="Storage"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144.9219" x="1314.0879" y="724.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130.9219" x="1321.0879" y="744.3154">File Storage (Host)</text></g><g><title>main-app .PHP.</title><rect fill="#FFFFFF" height="565.5938" style="stroke:#181818;stroke-width:1;" width="10" x="759.7456" y="149.7266"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1254.2827" y="281.5234"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="308.4609" style="stroke:#181818;stroke-width:1;" width="10" x="1254.2827" y="407.8594"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1259.2827" y="452.125"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1259.2827" y="583.7891"/></g><g><title>postgres-db</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1259.2827" y="642.0547"/></g><g><title>File Storage .Host.</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1381.5488" y="510.3906"/></g><g class="message" data-participant-1="User" data-participant-2="App"><polygon fill="#181818" points="747.7456,145.7266,757.7456,149.7266,747.7456,153.7266,751.7456,149.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="103.4556" x2="753.7456" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.9248" x="110.4556" y="144.6606">1. POST /media/{id}/delete</text></g><g class="message" data-participant-1="App" data-participant-2="App"><line style="stroke:#181818;stroke-width:1;" x1="769.7456" x2="811.7456" y1="178.8594" y2="178.8594"/><line style="stroke:#181818;stroke-width:1;" x1="811.7456" x2="811.7456" y1="178.8594" y2="191.8594"/><line style="stroke:#181818;stroke-width:1;" x1="770.7456" x2="811.7456" y1="191.8594" y2="191.8594"/><polygon fill="#181818" points="780.7456,187.8594,770.7456,191.8594,780.7456,195.8594,776.7456,191.8594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258.6162" x="776.7456" y="173.7935">2. Verifikasi sesi &amp; hak akses pengguna</text></g><g class="message" data-participant-1="App" data-participant-2="DB"><polygon fill="#181818" points="1242.2827,277.5234,1252.2827,281.5234,1242.2827,285.5234,1246.2827,281.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="769.7456" x2="1248.2827" y1="281.5234" y2="281.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313.4092" x="776.7456" y="215.9263">3. Periksa Ketergantungan (Dependency Check)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="465.5371" x="776.7456" y="231.0591">- SELECT COUNT(*) FROM user_profiles WHERE avatar_media_id = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408.2368" x="776.7456" y="246.1919">- SELECT COUNT(*) FROM stores WHERE logo_media_id = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="438.0771" x="776.7456" y="261.3247">- SELECT COUNT(*) FROM product_images WHERE media_id = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.8398" x="776.7456" y="276.4575">- ... (dan tabel lain yang relevan)</text></g><g class="message" data-participant-1="DB" data-participant-2="App"><polygon fill="#181818" points="780.7456,306.6563,770.7456,310.6563,780.7456,314.6563,776.7456,310.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="774.7456" x2="1258.2827" y1="310.6563" y2="310.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280.9409" x="786.7456" y="305.5903">4. Hasil Pemeriksaan (Jumlah penggunaan)</text></g><path d="M10,325.6563 L74.4429,325.6563 L74.4429,332.7891 L64.4429,342.7891 L10,342.7891 L10,325.6563" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="382.6641" style="stroke:#000000;stroke-width:1.5;" width="1459.0098" x="10" y="325.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="338.7231">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="272.6045" x="89.4429" y="337.8667">[jika media MASIH DIGUNAKAN (Count &gt; 0)]</text><g class="message" data-participant-1="App" data-participant-2="User"><polygon fill="#181818" points="114.4556,359.9219,104.4556,363.9219,114.4556,367.9219,110.4556,363.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="108.4556" x2="758.7456" y1="363.9219" y2="363.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="632.29" x="120.4556" y="358.856">5a. Response (Error: "File tidak dapat dihapus karena masih digunakan oleh produk/profil/toko.")</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="1469.0098" y1="372.9219" y2="372.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="302.1616" x="15" y="383.1323">[jika media TIDAK LAGI DIGUNAKAN (Count = 0)]</text><g class="message" data-participant-1="App" data-participant-2="DB"><polygon fill="#181818" points="1242.2827,403.8594,1252.2827,407.8594,1242.2827,411.8594,1246.2827,407.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="769.7456" x2="1248.2827" y1="407.8594" y2="407.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.5249" x="776.7456" y="402.7935">5b. START TRANSACTION</text></g><g class="message" data-participant-1="App" data-participant-2="DB"><polygon fill="#181818" points="1247.2827,448.125,1257.2827,452.125,1247.2827,456.125,1251.2827,452.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="769.7456" x2="1253.2827" y1="452.125" y2="452.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.896" x="776.7456" y="431.9263">6. Ambil path file dari database</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358.4141" x="776.7456" y="447.0591">SELECT file_path FROM media WHERE media_id = {id}</text></g><g class="message" data-participant-1="DB" data-participant-2="App"><polygon fill="#181818" points="780.7456,477.2578,770.7456,481.2578,780.7456,485.2578,776.7456,481.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="774.7456" x2="1253.2827" y1="481.2578" y2="481.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.3887" x="786.7456" y="476.1919">7. file_path</text></g><g class="message" data-participant-1="App" data-participant-2="Storage"><polygon fill="#181818" points="1369.5488,506.3906,1379.5488,510.3906,1369.5488,514.3906,1373.5488,510.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="769.7456" x2="1375.5488" y1="510.3906" y2="510.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.3105" x="776.7456" y="505.3247">8. Hapus file fisik dari disk</text></g><g class="message" data-participant-1="Storage" data-participant-2="App"><polygon fill="#181818" points="780.7456,535.5234,770.7456,539.5234,780.7456,543.5234,776.7456,539.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="774.7456" x2="1385.5488" y1="539.5234" y2="539.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.1978" x="786.7456" y="534.4575">9. Konfirmasi file dihapus</text></g><g class="message" data-participant-1="App" data-participant-2="DB"><polygon fill="#181818" points="1247.2827,579.7891,1257.2827,583.7891,1247.2827,587.7891,1251.2827,583.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="769.7456" x2="1253.2827" y1="583.7891" y2="583.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.1353" x="776.7456" y="563.5903">10. Hapus catatan dari database</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299.3237" x="776.7456" y="578.7231">DELETE FROM media WHERE media_id = {id}</text></g><g class="message" data-participant-1="DB" data-participant-2="App"><polygon fill="#181818" points="780.7456,608.9219,770.7456,612.9219,780.7456,616.9219,776.7456,612.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="774.7456" x2="1253.2827" y1="612.9219" y2="612.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.1504" x="786.7456" y="607.856">11. Konfirmasi catatan dihapus</text></g><g class="message" data-participant-1="App" data-participant-2="DB"><polygon fill="#181818" points="1247.2827,638.0547,1257.2827,642.0547,1247.2827,646.0547,1251.2827,642.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="769.7456" x2="1253.2827" y1="642.0547" y2="642.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.0015" x="776.7456" y="636.9888">12. COMMIT TRANSACTION</text></g><g class="message" data-participant-1="DB" data-participant-2="App"><polygon fill="#181818" points="780.7456,667.1875,770.7456,671.1875,780.7456,675.1875,776.7456,671.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="774.7456" x2="1253.2827" y1="671.1875" y2="671.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.646" x="786.7456" y="666.1216">13. Transaksi Sukses</text></g><g class="message" data-participant-1="App" data-participant-2="User"><polygon fill="#181818" points="114.4556,696.3203,104.4556,700.3203,114.4556,704.3203,110.4556,700.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="108.4556" x2="758.7456" y1="700.3203" y2="700.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306.3633" x="120.4556" y="695.2544">14. Response (Sukses: "File berhasil dihapus.")</text></g><!--SRC=[hLJRRjf047ttLunuQA4I9hH9BqY9v009b70HDkrB93JWnTxQNbkxwrHHrN_lh8svXKPzg1yixUvSpfmpCs-Xnp6GcC12vXe5v4Bd4JXnBc7CH11YbYkuup6Zey_HiZJNT2WCPZ9LJC6iiYFtGqjSwrH2RQ6OXFgC9JpcKMl60lo9l543L62Uh0obvckUeT1GIv2B9cOPEGncfP6JPPQF6bUe6DIoLEb0CjNqLyLhx_OuG070fSGOCAWFoBgCihsoh09EyyQ4XGwqRPXDNGzQYS7S-iNztosVnKmp0vy_eMO50CkOxxpUs_2DIRxX4IeEn067Dn1Y11WPGZ8Y9CW5xhnwj-JqWLAHKwGGHXHV1eGt5_I7Ue-HYy_4-Xcw8Lj7ZKVH1BV_qEzwq9qk9bxzNGFkvjCnv8H-cSbqGsKg-3xep_k0X1BbigXWoNsu1bF6NqCeOcBd6wT1-i-UbDVFrth94sAoYd36sRPjgFjK68d6OeX9KtX64O0aPfzGDFRSadn4JdF7xAKD0-8q9ggIaYp3pzSyYJ7SyMeY-EmmXeMnXXyaHma7neux741lUB-OE2Dd0lLkIeqDDt3Hi82-GXTAMZH31wxGXZbJMIgenUfzALFPsRQIvZxfwcE66dnUZaE4aWbAHK13kZIG8eAPnYmiEOfQfKGjdKQfNMjO5eifyW50RzXpHl3Wt0zVehokKEwXRbleQcM3wpbp3xovCt6ThZUSJWgh8p9EtJxQu2Gh8fMA2C6q3XKaELHJzIYsSfkdPM5Kw5r2FIlpYwJcVAJa9tiVhdWzKUm0P3Mk7VXiv3SK5o0tNF5e2vMhw3XdDT3ciWgmp_x5Xb4gDbmQaRObb-gTOjajXbFMsXSLc3NnP7RZ2Maz8ith_mUgskqZjBjqvm6VKxXD6wax7O-7htV6oyoqb3o9Gj7Yuk3cPdszccy_C-tBmvafNQkXMJ4P5bEyBS6C02quwt1gATmV]--></g></svg>